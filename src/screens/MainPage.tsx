import { Button, Flex, Modal, Text, Title } from "@mantine/core";
import { appendDataToDatabase, ResetDatabase } from "../utils/DropboxApi";
import { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";

export default function MainPage(props: any) {
  const [opened, setOpened] = useState(false);
  const navigate = useNavigate();

  // Kick unauthorized users to landing page.
  useEffect(() => {
    const queryParams = new URLSearchParams(window.location.search);
    if (queryParams.get("code")) {
      navigate("/authorize");
    } else if (!props.loggedIn) {
      navigate("/landing");
    }
  });

  return (
    <>
      <Modal
        withCloseButton={false}
        opened={opened}
        title="Delete Database Contents?"
        onClose={() => {
          setOpened(false);
        }}
      >
        <Text>NOTE: Deleted data cannot be recovered</Text>
        <Flex direction="row" style={{ justifyContent: "center" }}>
          <Button
            onClick={() => {
              ResetDatabase();
              setOpened(false);
            }}
            style={{ margin: "0px 20px" }}
          >
            Delete
          </Button>
          <Button
            onClick={() => setOpened(false)}
            style={{ margin: "0px 20px" }}
          >
            Cancel
          </Button>
        </Flex>
      </Modal>

      <Title size="h5" style={{ alignSelf: "center" }}>
        Database Contents:
      </Title>
      <Flex
        direction="column"
        style={{ minHeight: "10em", minWidth: "10em", border: "solid" }}
      ></Flex>
      <br />
      <Button style={{ width: "15%" }} onClick={() => setOpened(true)}>
        Empty Database
      </Button>
    </>
  );
}
